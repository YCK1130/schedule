import{r as e,j as s,F as i,a as n,C as t,O as a,d as r,R as l,b as o,c}from"./bootstrap-ui-CpibWHK_.js";import{a as d,u as m}from"./index-74dCG_Iq.js";import{h as u,l as x,j as h}from"./utils-DJ2i655f.js";import"./react-vendor-C7tYskqo.js";import"./scheduler-algos-DzC9Ax8u.js";import"./xlsx-DgL3v4p1.js";import"./vendor-utils-B86ZpiIR.js";const j=({index:t,groupId:a,restriction:r,positionsList:l,onPositionChange:o,onMinChange:c,onMaxChange:d,removeRow:m,disableDelelete:u})=>{const[x,h]=e.useState(r.minCount?.toString()||""),[j,v]=e.useState(r.maxCount?.toString()||""),[p,N]=e.useState(null),[w,g]=e.useState(null);e.useEffect(()=>{h(r.minCount?.toString()||""),v(r.maxCount?.toString()||"")},[r.minCount,r.maxCount]);const f=e.useCallback(e=>{const s=e.target.value;h(s),p&&clearTimeout(p);const i=setTimeout(()=>{if(""===s)c(null);else{const e=parseInt(s,10);if(!isNaN(e)){const s=""===j?1/0:parseInt(j,10);e>s&&!isNaN(s)?(h(j),c(parseInt(j,10))):e<1?(h("1"),c(1)):c(e)}}},500);N(i)},[p,j,c]),C=e.useCallback(e=>{const s=e.target.value;v(s),w&&clearTimeout(w);const i=setTimeout(()=>{if(""===s)d(null);else{const e=parseInt(s,10);if(!isNaN(e)){const s=""===x?0:parseInt(x,10);e<s&&!isNaN(s)?(v(x),d(parseInt(x,10))):d(e)}}},500);g(i)},[w,x,d]);return e.useEffect(()=>()=>{p&&clearTimeout(p),w&&clearTimeout(w)},[p,w]),s.jsx("div",{className:"restriction-box",children:s.jsxs("div",{className:"restriction-row",children:[s.jsx(i.Select,{value:r.targetPosition||"所有",className:"restriction-column",onChange:o,children:l.map(e=>s.jsx("option",{value:e,children:e},`${a}-${e}-constraint${t}`))}),s.jsx(i.Control,{type:"number",className:"restriction-column",min:"1",value:x,onChange:f,placeholder:"最小數量"}),s.jsx(s.Fragment,{children:"~"}),s.jsx(i.Control,{type:"number",className:"restriction-column",min:x||"1",value:j,onChange:C,placeholder:"最大數量"}),s.jsx(n,{variant:"outline-danger",size:"sm",className:"remove-btn",onClick:m,disabled:u,children:"✕"})]})},`${a}-constraint${t}`)},v=()=>{const{groupRestrictions:c,updateGroupRestriction:v,addRestriction:p,removeRestriction:N}=d(),{onIntervieweesLoaded:w,onInterviewersLoaded:g,positions:f}=m(),[C,b]=e.useState(""),[y,I]=e.useState(""),S=e=>{const s=e.target.files?.[0];s&&h(s,b,g,"interviewers")},R=e=>{const s=e.target.files?.[0];s&&h(s,I,w,"interviewees")},k=e.useMemo(()=>({interviewers:L("interviewers"),interviewees:L("interviewees")}),[c,f,L]);function L(e){return s.jsxs("div",{className:"restrictions-container",children:[s.jsxs("span",{className:"restriction-label",children:["interviewers"===e?"面試官":"應試者"," 數量條件限制"]}),"interviewees"===e?s.jsx("div",{className:"restriction-box",children:s.jsx("div",{className:"restriction-row",style:{color:"gray",fontWeight:500},children:"職位相同"})},"interviewees-same-position-constrain"):null,c[e].map((i,n)=>s.jsx(j,{index:n,groupId:e,restriction:i,positionsList:f[e],onPositionChange:s=>v(e,n,{targetPosition:s.target.value}),onMinChange:s=>{null!==s&&v(e,n,{minCount:s})},onMaxChange:s=>{null!==s&&v(e,n,{maxCount:s})},removeRow:()=>N(e,n),disableDelelete:c[e].length<=1},`${n}-ConstraintRow`)),s.jsx("div",{className:"restriction-actions",children:s.jsx(n,{variant:"outline-primary",size:"sm",onClick:()=>p(e),children:"+ 新增條件"})})]})}return s.jsxs(t,{className:"mb-4 upload-card",children:[s.jsxs(t.Header,{as:"h5",className:"d-flex justify-content-between align-items-center",children:["上傳資料檔案",s.jsx(a,{placement:"left",overlay:s.jsx(r,{children:s.jsxs("div",{style:{textAlign:"left"},children:[s.jsx("div",{children:"您可以："}),s.jsxs("ul",{className:"mb-0 ps-3",children:[s.jsx("li",{children:"下載範例檔案格式"}),s.jsx("li",{children:"直接載入範例資料試用"})]})]})}),children:s.jsx("span",{className:"ms-2 text-muted",children:"ℹ️"})})]}),s.jsx(t.Body,{children:s.jsxs(i,{className:"w-100",children:[s.jsx(l,{className:"file-upload-row",children:["interviewers","interviewees"].map(e=>s.jsx(o,{className:"file-upload-col",children:s.jsxs(i.Group,{children:[s.jsxs("div",{className:"file-upload-header",children:[s.jsx(i.Label,{children:"interviewers"===e?"面試官檔案":"應試者檔案"}),s.jsxs("div",{className:"file-actions",children:[s.jsx(n,{variant:"outline-secondary",size:"sm",onClick:()=>u(e),className:"sample-btn",children:"📥 範例"}),s.jsx(n,{variant:"outline-info",size:"sm",onClick:()=>(async e=>{"interviewers"===e?await x(e,b,g):"interviewees"===e&&await x(e,I,w)})(e),className:"try-btn",children:"⚡️ 試用"})]})]}),s.jsx(i.Control,{type:"file",accept:".csv,.xlsx,.xls",onChange:"interviewers"===e?S:R,className:"upload-input"}),k[e]]})},e))}),s.jsxs("div",{className:"file-preview",children:[C&&s.jsx("div",{className:"preview-item",children:s.jsxs("span",{className:"text-success",children:["✓ Interviewers: ",C]})}),y&&s.jsx("div",{className:"preview-item",children:s.jsxs("span",{className:"text-success",children:["✓ Interviewees: ",y]})})]})]})})]})},p=()=>{const{generateSchedule:e}=d(),{scheduledInterviews:i,dataLoaded:n,loading:t}=m(),a=n.interviewers&&n.interviewees;return s.jsxs(c,{className:"py-2",children:[s.jsx(l,{className:"fix-width-container",children:s.jsx(o,{style:{display:"flex",justifyContent:"center"},children:s.jsx(v,{})})}),a&&s.jsx(l,{className:"fix-width-container",children:s.jsx(o,{className:"text-end",children:s.jsx("button",{className:"continue-btn",onClick:e,children:t?s.jsx("div",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):i.length>0?"重新配對 🔄":"開始配對 ▶"})})})]})};export{p as default};
